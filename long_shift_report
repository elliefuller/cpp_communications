SELECT A.COMPANY, B.NAME "EMPLOYEE_NAME", A.EMPLID, J.EMAIL_ADDR "EMPLOYEE_EMAIL", E.TL_QUANTITY, TO_CHAR(CAST((E.PUNCH_DTTM) AS TIMESTAMP),
	'YYYY-MM-DD HH:MI:SSAM') "Punch Time", D.NAME "TL_APPR_NAME", H.EMAIL_ADDR "TL_APPR_EMAIL", G.NAME "REPORTS_TO_NAME", I.EMAIL_ADDR "REPORTS_TO_EMAIL"
  FROM (((((SYSADM.PS_JOB A) LEFT OUTER JOIN  (SYSADM.PS_POSN_INCUMBENT F ) ON  F.POSITION_NBR = A.REPORTS_TO ) LEFT OUTER JOIN  (SYSADM.PS_NAMES G) 
  ON  G.EMPLID = F.EMPLID AND G.NAME_TYPE = 'PRI' ) LEFT OUTER JOIN  (SYSADM.PS_EMAIL_ADDRESSES I) ON  G.EMPLID = I.EMPLID AND I.E_ADDR_TYPE = 'BUSN' ) 
  LEFT OUTER JOIN  (SYSADM.PS_EMAIL_ADDRESSES J) ON  A.EMPLID = J.EMPLID AND J.E_ADDR_TYPE = 'BUSN' ), SYSADM.PS_TL_RPTD_TIME E, SYSADM.PS_NAMES B, 
  ((SYSADM.PS_TL_EMPL_DATA C LEFT OUTER JOIN  (SYSADM.PS_NAMES D) ON  D.EFFDT =
        (SELECT MAX(D_ED.EFFDT) FROM SYSADM.PS_NAMES D_ED
        WHERE D.EMPLID = D_ED.EMPLID
          AND D.NAME_TYPE = D_ED.NAME_TYPE
          AND D_ED.EFFDT <= SYSDATE) AND D.EMPLID = C.RULE_ELEMENT_5 AND D.NAME_TYPE = 'PRI' ) LEFT OUTER JOIN  (SYSADM.PS_EMAIL_ADDRESSES H) 
          ON  D.EMPLID = H.EMPLID AND H.E_ADDR_TYPE = 'BUSN' )
         WHERE ( A.EFFDT =
        (SELECT MAX(A_ED.EFFDT) FROM SYSADM.PS_JOB A_ED
        WHERE A.EMPLID = A_ED.EMPLID
          AND A.EMPL_RCD = A_ED.EMPL_RCD
          AND A_ED.EFFDT <= SYSDATE)
    AND A.EFFSEQ =
        (SELECT MAX(A_ES.EFFSEQ) FROM SYSADM.PS_JOB A_ES
        WHERE A.EMPLID = A_ES.EMPLID
          AND A.EMPL_RCD = A_ES.EMPL_RCD
          AND A.EFFDT = A_ES.EFFDT)
     AND A.EMPLID = E.EMPLID
     AND A.EMPL_RCD = E.EMPL_RCD
     AND E.PUNCH_DTTM > TO_DATE(:PAY_BEGIN_DATE ,'YYYY-MM-DD')
     AND E.TL_QUANTITY > 15.00
     AND A.COMPANY = :COMPANY
               
     AND A.EMPLID = B.EMPLID
     AND B.EFFDT =
        (SELECT MAX(B_ED.EFFDT) FROM SYSADM.PS_NAMES B_ED
        WHERE B.EMPLID = B_ED.EMPLID
          AND B.NAME_TYPE = B_ED.NAME_TYPE
          AND B_ED.EFFDT <= SYSDATE)
     AND B.NAME_TYPE = 'PRI'
     AND A.EMPLID = C.EMPLID
     AND A.EMPL_RCD = C.EMPL_RCD
     AND C.EFFDT =
        (SELECT MAX(C_ED.EFFDT) FROM SYSADM.PS_TL_EMPL_DATA C_ED
        WHERE C.EMPLID = C_ED.EMPLID
          AND C.EMPL_RCD = C_ED.EMPL_RCD
          AND C_ED.EFFDT <= SYSDATE) )
