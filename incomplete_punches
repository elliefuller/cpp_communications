SELECT DISTINCT A.EMPLID, A.EMPL_RCD, C.NAME "EMPLOYEE_NAME", H.EMAIL_ADDR, B.COMPANY, B.PAYGROUP, 
 D.RULE_ELEMENT_5, E.NAME "TL_APPR_NAME", K.EMAIL_ADDR "TL_APPR_EMAIL", I.EMPLID "REPORTS_TO_EMPLID",
  L.EMAIL_ADDR "REPORTS_TO_EMAIL"
  FROM SYSADM.PS_TL_RPTD_TIME A, ((((SYSADM.PS_JOB B ) LEFT OUTER JOIN  (SYSADM.PS_POSN_INCUMBENT I) ON  I.POSITION_NBR = B.REPORTS_TO ) LEFT OUTER JOIN  SYSADM.PS_NAMES_VW J ON  J.EMPLID = I.EMPLID AND J.EFFDT =
        (SELECT MAX(J_ED.EFFDT) FROM SYSADM.PS_NAMES_VW J_ED
        WHERE J.EMPLID = J_ED.EMPLID
          AND J.NAME_TYPE = J_ED.NAME_TYPE
          AND J_ED.EFFDT <= SYSDATE) AND J.NAME_TYPE = 'PRI' ) LEFT OUTER JOIN  (SYSADM.PS_EMAIL_ADDRESSES L) ON  L.EMPLID = I.EMPLID AND L.E_ADDR_TYPE = 'BUSN' ), ((SYSADM.PS_TL_EMPL_DATA D LEFT OUTER JOIN  SYSADM.PS_NAMES_VW E ON  E.EFFDT =
        (SELECT MAX(E_ED.EFFDT) FROM SYSADM.PS_NAMES_VW E_ED
        WHERE E.EMPLID = E_ED.EMPLID
          AND E.NAME_TYPE = E_ED.NAME_TYPE
          AND E_ED.EFFDT <= SYSDATE) AND E.NAME_TYPE = 'PRI' AND D.RULE_ELEMENT_5 = E.EMPLID ) LEFT OUTER JOIN  (SYSADM.PS_EMAIL_ADDRESSES K) ON  E.EMPLID = K.EMPLID AND K.E_ADDR_TYPE = 'BUSN' ), SYSADM.PS_NAMES C, SYSADM.PS_EMAIL_ADDRESSES H
  WHERE ( ( A.DUR BETWEEN TO_DATE(:PAY_BEGIN_DT,'YYYY-MM-DD') AND TO_DATE(:PAY_END_DT,'YYYY-MM-DD')
     AND A.PUNCH_TYPE IN ('1','3')
     AND A.EMPLID = B.EMPLID
     AND A.EMPL_RCD = B.EMPL_RCD
     AND B.COMPANY = :COMPANY
     AND B.EFFDT =
        (SELECT MAX(B_ED.EFFDT) FROM SYSADM.PS_JOB B_ED
        WHERE B.EMPLID = B_ED.EMPLID
          AND B.EMPL_RCD = B_ED.EMPL_RCD
          AND B_ED.EFFDT <= SYSDATE)
    AND B.EFFSEQ =
        (SELECT MAX(B_ES.EFFSEQ) FROM SYSADM.PS_JOB B_ES
        WHERE B.EMPLID = B_ES.EMPLID
          AND B.EMPL_RCD = B_ES.EMPL_RCD
          AND B.EFFDT = B_ES.EFFDT)
     AND A.EMPLID = D.EMPLID
     AND A.EMPL_RCD = D.EMPL_RCD
     AND D.EFFDT =
        (SELECT MAX(D_ED.EFFDT) FROM SYSADM.PS_TL_EMPL_DATA D_ED
        WHERE D.EMPLID = D_ED.EMPLID
          AND D.EMPL_RCD = D_ED.EMPL_RCD
          AND D_ED.EFFDT <= SYSDATE)
     AND NOT EXISTS (SELECT 'X'
  FROM SYSADM.PS_TL_RPTD_TIME F
  WHERE ( F.EMPLID = A.EMPLID
     AND F.EMPL_RCD = A.EMPL_RCD
     AND F.PUNCH_TYPE IN ('2','3','1')
     AND F.PUNCH_DTTM = (SELECT min( G.PUNCH_DTTM)
  FROM SYSADM.PS_TL_RPTD_TIME G
  WHERE ( G.EMPLID = F.EMPLID
     AND G.EMPL_RCD = F.EMPL_RCD
     AND G.PUNCH_DTTM > A.PUNCH_DTTM ))
     AND F.PUNCH_TYPE <> (case when  A.PUNCH_TYPE = '1' then '1' else '0'end)
     AND F.PUNCH_TYPE <> (case when  A.PUNCH_TYPE = '3' then '2' else '0'end)
     AND F.PUNCH_TYPE <> (case when  A.PUNCH_TYPE = '3' then '3' else '0'end)
      ))
     AND A.DUR < trunc(sysdate)
     AND B.EMPLID = C.EMPLID
     AND C.EFFDT =
        (SELECT MAX(C_ED.EFFDT) FROM SYSADM.PS_NAMES C_ED
        WHERE C.EMPLID = C_ED.EMPLID
          AND C.NAME_TYPE = C_ED.NAME_TYPE
          AND C_ED.EFFDT <= SYSDATE)
     AND C.NAME_TYPE = 'PRI'
     AND A.EMPLID = H.EMPLID
     AND H.E_ADDR_TYPE = 'BUSN' ))
  ORDER BY 5, 6, 1, 7
